[build]
functions = "functions"
publish = "."

# Headers para cache de arquivos est√°ticos
[[headers]]
for = "/*.html"
[headers.values]
Cache-Control = "no-cache"

[[redirects]]
from = "/api/auth/*"
to = "/.netlify/functions/auth/:splat"
status = 200
force = true

[[redirects]]
from = "/api/anny"
to = "/.netlify/functions/anny-ai"
status = 200
force = true

[[redirects]]
from = "/api/webhook/events"
to = "/.netlify/functions/webhook-handler"
status = 200
force = true

[[redirects]]
from = "/api/facilzap-proxy"
to = "/.netlify/functions/facilzap-proxy"
status = 200
force = true

[[redirects]]
from = "/api/supabase-sync"
to = "/.netlify/functions/supabase-sync"
status = 200
force = true

[[redirects]]
from = "/facilzap-images/*"
to = "/.netlify/functions/image-proxy?url=:splat"
status = 200
force = true

# WhatsApp & CRM proxy routes (Central de Atendimento)
[[redirects]]
from = "/api/whatsapp/*"
to = "/.netlify/functions/whatsapp-proxy?route=whatsapp/:splat"
status = 200
force = true

[[redirects]]
from = "/api/client-brain/*"
to = "/.netlify/functions/whatsapp-proxy?route=client-brain/:splat"
status = 200
force = true

[[redirects]]
from = "/api/client-profile"
to = "/.netlify/functions/whatsapp-proxy?route=client-profile"
status = 200
force = true

[[redirects]]
from = "/api/client-lookup"
to = "/.netlify/functions/whatsapp-proxy?route=client-lookup"
status = 200
force = true

[[redirects]]
from = "/api/sync-client-name"
to = "/.netlify/functions/whatsapp-proxy?route=sync-client-name"
status = 200
force = true

# AI Ecosystem routes
[[redirects]]
from = "/api/ai/orchestrator"
to = "/.netlify/functions/ai-orchestrator"
status = 200
force = true

[[redirects]]
from = "/api/ai/webhook"
to = "/.netlify/functions/evolution-webhook"
status = 200
force = true

[[redirects]]
from = "/webhook/evolution"
to = "/.netlify/functions/evolution-webhook"
status = 200
force = true

[functions]
node_bundler = "esbuild"

[functions."facilzap-proxy"]
timeout = 60

[functions."supabase-sync"]
timeout = 30

[functions."image-proxy"]
timeout = 10

[functions."whatsapp-proxy"]
timeout = 30

[functions."ai-orchestrator"]
timeout = 30

[functions."evolution-webhook"]
timeout = 15
